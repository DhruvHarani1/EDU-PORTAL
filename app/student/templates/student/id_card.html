{% extends "base_student.html" %}

{% block title %}Digital ID Card | EduPortal{% endblock %}
{% block header_title %}Digital Identity{% endblock %}

{% block student_content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;500;600;700&display=swap');

    .font-logo { font-family: 'Orbitron', sans-serif; }
    .font-body { font-family: 'Inter', sans-serif; }

    /* 3D Flip Mechanics */
    .perspective-1000 { perspective: 1000px; }
    .transform-style-3d { transform-style: preserve-3d; }
    .backface-hidden { backface-visibility: hidden; }
    .rotate-y-180 { transform: rotateY(180deg); }

    /* Flip on Group Hover */
    .group:hover .card-inner {
        transform: rotateY(180deg);
    }

    /* Card Design */
    .card-front {
        background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    .card-back {
        background: #111827;
        box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
    }
    
    /* Print Optimization */
    @media print {
        @page { margin: 0.5cm; }
        body * { visibility: hidden; }
        #id-card-wrapper, #id-card-wrapper * { visibility: visible; }
        
        #id-card-wrapper {
            position: absolute; 
            left: 0; 
            top: 0;
            width: 100% !important;
            height: auto !important;
            transform: none !important;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Disable 3D transforms for print and show both sides */
        .perspective-1000 { perspective: none !important; }
        .transform-style-3d { transform-style: flat !important; }
        .card-inner { 
            transform: none !important; 
            position: static !important; /* Allow flow */
            width: 100% !important;
            height: auto !important;
            display: block !important;
        }
        
        /* Un-stack the faces */
        .card-front, .card-back {
            position: relative !important; /* Stack vertically */
            inset: auto !important;
            transform: none !important; /* Remove rotateY(180) from back */
            backface-visibility: visible !important;
            margin-bottom: 20px;
            border: 1px solid #ddd; /* Light border for contrast on paper */
            page-break-inside: avoid;
            width: 350px; /* Fixed print width */
            height: 220px; /* Fixed print height */
        }
        
        /* Hide controls */
        #controls { display: none !important; }
    }
</style>

<div class="min-h-[calc(100vh-8rem)] flex flex-col items-center justify-center p-4">
    
    <!-- Card Container -->
    <div id="id-card-wrapper" class="perspective-1000 w-full max-w-[450px] group cursor-pointer h-[280px]"> <!-- Increased Width & Height -->
        
        <div class="card-inner relative w-full h-full duration-700 transform-style-3d transition-transform">
            
            <!-- ====== FRONT ====== -->
            <div class="absolute inset-0 w-full h-full backface-hidden rounded-xl overflow-hidden card-front shadow-2xl">
                <!-- Decorative Top Bar -->
                <div class="h-2 bg-indigo-500 w-full"></div>
                
                <div class="p-6 h-full flex flex-col font-body text-white">
                    <!-- Header -->
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center gap-3">
                            <!-- Logo Icon -->
                            <div class="w-8 h-8 rounded bg-indigo-600 flex items-center justify-center text-white">
                                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                            </div>
                            <div>
                                <h1 class="text-xs font-logo font-bold tracking-widest leading-none">UNIVERSE <span class="text-indigo-400">UNIV</span></h1>
                                <p class="text-[10px] text-gray-400 uppercase tracking-widest mt-0.5">Student Identity</p>
                            </div>
                        </div>
                        <!-- Chip -->
                        <div class="w-9 h-7 rounded bg-gradient-to-br from-yellow-200 to-yellow-600 opacity-90 border border-yellow-700"></div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex gap-5 items-start">
                        <!-- Photo -->
                        <div class="w-24 h-24 rounded-lg bg-gray-800 border-2 border-indigo-500/50 overflow-hidden flex-shrink-0">
                            <img src="https://ui-avatars.com/api/?name={{ student.display_name }}&background=0f172a&color=fff&size=200&font-size=0.33" class="w-full h-full object-cover">
                        </div>
                        
                        <!-- Details -->
                        <div class="flex-1 space-y-3 min-w-0"> <!-- min-w-0 for truncating -->
                            <div>
                                <h2 class="text-lg font-bold text-white truncate leading-tight">{{ student.display_name }}</h2>
                                <p class="text-xs text-indigo-300 font-medium">Student</p>
                            </div>
                            
                            <div class="grid grid-cols-1 gap-1">
                                <div>
                                    <p class="text-[9px] text-gray-500 uppercase font-bold">Enrollment ID</p>
                                    <p class="text-sm font-semibold text-white tracking-wide">{{ student.enrollment_number }}</p>
                                </div>
                                <div class="mt-1">
                                    <p class="text-[9px] text-gray-500 uppercase font-bold">Course / Batch</p>
                                    <p class="text-xs text-gray-200">{{ student.course_name }} ({{ student.batch_year or '2025' }})</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="mt-auto pt-2 flex justify-between items-end">
                        <div></div> <!-- Spacer -->
                        <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ student.enrollment_number }}&bgcolor=255-255-255&color=0-0-0&margin=0" class="w-10 h-10 rounded bg-white p-0.5">
                    </div>
                </div>
            </div>

            <!-- ====== BACK ====== -->
            <div class="absolute inset-0 w-full h-full backface-hidden rotate-y-180 rounded-xl overflow-hidden card-back shadow-2xl">
                 <div class="h-10 bg-black mt-6 w-full relative"></div>
                 
                 <div class="p-6 font-body">
                     <div class="flex justify-between text-xs text-gray-400 mb-6 border-b border-gray-700 pb-2">
                         <div>
                             <span class="block text-[8px] uppercase font-bold text-gray-600">Date of Birth</span>
                             <span class="text-white">{{ student.date_of_birth.strftime('%d %b %Y') if student.date_of_birth else 'N/A' }}</span>
                         </div>
                         <div class="text-right">
                             <span class="block text-[8px] uppercase font-bold text-gray-600">Blood Group</span>
                             <span class="text-white">O+</span>
                         </div>
                     </div>
                     
                     <div class="text-[10px] text-gray-500 leading-relaxed text-justify mb-4">
                         This card is non-transferable and must be presented upon request. Report loss immediately to the Registrar.
                         <br>
                         <strong>University Address:</strong> Campus Rd, Education City.
                     </div>
                     
                     <div class="text-center pt-2">
                         <div class="h-8 mb-1 flex items-end justify-center">
                             <span class="font-serif italic text-gray-400 text-xs">RegistrarSign</span>
                         </div>
                         <p class="text-[8px] text-gray-600 uppercase tracking-widest border-t border-gray-700 pt-1 inline-block px-4">Authorized Signature</p>
                     </div>
                 </div>
            </div>

        </div>
    </div>

    <!-- Controls -->
    <div id="controls" class="mt-8 text-center">
        <p class="text-sm text-gray-500 mb-4 animate-pulse">Hover card to see details</p>
        <button onclick="window.print()" class="px-6 py-2 rounded-full bg-white border border-gray-200 text-gray-700 text-sm font-medium shadow-sm hover:bg-gray-50 transition-colors">
            Download / Print
        </button>
    </div>

</div>
{% endblock %}
