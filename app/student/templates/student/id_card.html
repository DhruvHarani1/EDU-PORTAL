{% extends "base_student.html" %}

{% block title %}Digital ID Card | EduPortal{% endblock %}
{% block header_title %}Digital Identity{% endblock %}

{% block student_content %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Share+Tech+Mono&display=swap');

    .perspective-1000 { perspective: 1000px; }
    .transform-style-3d { transform-style: preserve-3d; }
    .backface-hidden { backface-visibility: hidden; }
    .rotate-y-180 { transform: rotateY(180deg); }
    
    /* Holographic Effect */
    .holo-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(115deg, transparent 40%, rgba(255, 255, 255, 0.4) 45%, rgba(255, 255, 255, 0.2) 50%, transparent 55%);
        background-size: 200% 200%;
        animation: holo-shine 4s infinite linear;
        pointer-events: none;
        z-index: 10;
        mix-blend-mode: overlay;
    }
    
    @keyframes holo-shine {
        0% { background-position: 200% 200%; }
        100% { background-position: -50% -50%; }
    }

    /* Premium Card Texture */
    .card-texture {
        background: #0f172a;
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(79, 70, 229, 0.4) 0%, transparent 40%),
            radial-gradient(circle at 90% 80%, rgba(236, 72, 153, 0.3) 0%, transparent 40%),
            url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
    }
    
    .gold-chip {
        background: linear-gradient(135deg, #bbb 0%, #d4ae5e 20%, #f3d489 40%, #d4ae5e 60%, #997e3a 100%);
        box-shadow: inset 0 1px 2px rgba(0,0,0,0.2), 0 1px 1px rgba(255,255,255,0.4);
    }

    .font-tech { font-family: 'Orbitron', sans-serif; }
    .font-mono-tech { font-family: 'Share Tech Mono', monospace; }
    
    @media print {
        body * { visibility: hidden; }
        #id-card-container, #id-card-container * { visibility: visible; }
        #id-card-container {
            position: absolute; left: 50%; top: 50%;
            transform: translate(-50%, -50%) scale(1);
            print-color-adjust: exact;
            -webkit-print-color-adjust: exact;
        }
        #controls, #sidebar, header { display: none !important; }
    }
</style>

<div class="min-h-[calc(100vh-8rem)] flex flex-col items-center justify-center py-12 px-4 relative overflow-hidden">
    
    <!-- Ambient Glow -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-indigo-500/20 blur-[100px] rounded-full"></div>
    </div>

    <!-- 3D Flip Container -->
    <div id="id-card-container" class="perspective-1000 w-full max-w-[420px] group select-none">
        <div id="card-inner" class="relative w-full aspect-[1.586/1] transition-all duration-700 transform-style-3d shadow-2xl rounded-xl cursor-pointer" onclick="toggleFlip()">
            
            <!-- FRONT FACE -->
            <div class="absolute inset-0 w-full h-full backface-hidden rounded-xl overflow-hidden card-texture border border-white/10 shadow-inner">
                <div class="holo-overlay"></div>
                
                <div class="relative h-full flex flex-col p-6 z-20">
                    <!-- Top Bar -->
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-lg bg-white/10 backdrop-blur-md flex items-center justify-center border border-white/20">
                                <svg class="w-6 h-6 text-indigo-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-sm font-tech font-bold text-white tracking-wider">UNIVERSE<span class="text-indigo-400">UNIVERSITY</span></h1>
                                <p class="text-[9px] text-gray-300 tracking-[0.2em] uppercase">Student Identity</p>
                            </div>
                        </div>
                        <!-- Smart Chip -->
                        <div class="w-10 h-8 rounded-md gold-chip relative overflow-hidden border border-[#997e3a]">
                            <div class="absolute inset-0 border border-black/20 rounded-[inherit]"></div>
                            <div class="absolute top-2 left-0 right-0 h-[1px] bg-black/20"></div>
                            <div class="absolute bottom-2 left-0 right-0 h-[1px] bg-black/20"></div>
                            <div class="absolute top-0 bottom-0 left-3 w-[1px] bg-black/20"></div>
                            <div class="absolute top-0 bottom-0 right-3 w-[1px] bg-black/20"></div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex gap-5 items-center flex-1">
                        <!-- Photo -->
                        <div class="relative">
                            <div class="w-28 h-28 rounded-xl overflow-hidden border-2 border-indigo-400/50 shadow-lg shadow-indigo-500/20 bg-gray-800">
                                <img src="https://ui-avatars.com/api/?name={{ student.display_name }}&background=6366f1&color=fff&size=200&font-size=0.35" class="w-full h-full object-cover">
                            </div>
                            <!-- Verified Badge -->
                            <div class="absolute -bottom-2 -right-2 bg-gradient-to-r from-emerald-500 to-teal-500 text-white p-1 rounded-full border-2 border-[#0f172a] shadow-sm">
                                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Text Details -->
                        <div class="space-y-2 flex-1">
                            <div>
                                <h2 class="text-xl font-bold text-white leading-tight mb-0.5">{{ student.display_name }}</h2>
                                <p class="text-xs text-indigo-300 uppercase tracking-wider font-semibold opacity-80">Student</p>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-y-2 gap-x-1 pt-1">
                                <div>
                                    <p class="text-[9px] text-gray-400 uppercase font-bold tracking-wider">Course</p>
                                    <p class="text-xs font-medium text-gray-200 truncate">{{ student.course_name }}</p>
                                </div>
                                <div>
                                    <p class="text-[9px] text-gray-400 uppercase font-bold tracking-wider">ID Number</p>
                                    <p class="font-mono-tech text-xs text-indigo-200 tracking-wide">{{ student.enrollment_number }}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Bar -->
                    <div class="mt-auto pt-3 border-t border-white/5 flex justify-between items-end">
                       <div class="font-mono-tech text-[10px] text-gray-400">
                           VALID: <span class="text-white">2023 - 2027</span>
                       </div>
                       <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data={{ student.enrollment_number }}" class="w-10 h-10 bg-white p-0.5 rounded opacity-90 mix-blend-screen">
                    </div>
                </div>
            </div>

            <!-- BACK FACE -->
            <div class="absolute inset-0 w-full h-full backface-hidden rotate-y-180 rounded-xl overflow-hidden bg-[#111] border border-gray-700 shadow-xl">
                <!-- Magnetic Strip -->
                <div class="h-10 bg-[#000] mt-6 w-full relative border-y border-gray-800"></div>

                <div class="p-6 flex flex-col h-[calc(100%-4rem)] justify-between">
                    <div class="space-y-4">
                        <div class="flex justify-between text-xs text-gray-500 font-mono-tech border-b border-gray-800 pb-2">
                            <span>DOB: {{ student.date_of_birth.strftime('%d %b %Y') }}</span>
                            <span>B.GRP: O+</span>
                        </div>
                        
                        <div class="text-[9px] text-gray-400 text-justify leading-relaxed opacity-80">
                            <p class="mb-2">This card is the property of Universe University. If found, please return to the Registrar's Office or verify status at <strong>portal.universe.edu/verify</strong>.</p>
                            <p>Unauthorized use of this identity document serves as a violation of university protocols under Article 42.</p>
                        </div>
                    </div>

                    <div class="flex items-end justify-between">
                        <div class="w-28 text-center">
                            <div class="h-8 border-b border-gray-600 mb-1 flex items-end justify-center">
                                <span class="font-handwriting text-gray-500 italic text-sm transform -rotate-3 block">AutoAuthorized</span>
                            </div>
                            <p class="text-[8px] text-gray-600 uppercase tracking-widest">Registrar Signature</p>
                        </div>
                        
                        <!-- Barcode -->
                        <div class="bg-white p-1 rounded-sm opacity-90">
                           <img src="https://bwipjs-api.metafloor.com/?bcid=code128&text={{ student.enrollment_number }}&scale=2&height=5&incltext&textsize=6" class="h-8 w-auto mix-blend-multiply">
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Controls -->
    <div id="controls" class="mt-10 flex gap-4 animate-fade-in-up">
        <button onclick="toggleFlip()" class="px-6 py-2.5 rounded-full bg-white/5 hover:bg-white/10 border border-white/10 text-white text-sm font-medium transition-all hover:scale-105 active:scale-95 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
            Flip Card
        </button>
        <button onclick="window.print()" class="px-6 py-2.5 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 border border-transparent text-white text-sm font-medium shadow-lg shadow-indigo-500/40 transition-all hover:scale-105 active:scale-95 flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2-2v4h10z" /></svg>
            Download Card
        </button>
    </div>

</div>

<script>
    function toggleFlip() {
        document.getElementById('card-inner').classList.toggle('rotate-y-180');
    }
</script>
{% endblock %}
